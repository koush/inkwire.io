function nextTick(e){setTimeout(e,0)}function make4Len16(e){var o=e.toString(16);while(o.length<4){o="0"+o}return o}function encode_utf8(e){return unescape(encodeURIComponent(e))}function decode_utf8(e){return decodeURIComponent(escape(e))}function ab2str(e){if(e.constructor.name=="ArrayBuffer"){e=new Uint8Array(e)}return decode_utf8(String.fromCharCode.apply(null,e))}function str2ab(e,o,n){e=encode_utf8(e);var t=e.length;if(n)t++;if(!o){o=new ArrayBuffer(t)}var r=new Uint8Array(o);if(n)r[e.length]=0;for(var a=0,i=e.length;a<i;a++){r[a]=e.charCodeAt(a)}return o}var slashN="\n".charCodeAt(0);function writeLine(e,o,n){if(o.constructor.name=="Object")o=JSON.stringify(o);writeString(e,o+"\n",n)}function readLine(e,o){var n=[];function t(){e.read(function(r){for(var a=0;a<r.byteLength;a++){if(r[a]==slashN){var i=r.subarray(0,a);n.push(i);var c="";for(var l in n){l=n[l];c+=ab2str(l)}var u=r.subarray(a+1);e.unshift(u);o(c);return}}n.push(r);t()})}t()}function readString(e,o){var n="";e.onClose=function(){o(n)};function t(o){n+=ab2str(o);e.read(t)}e.read(t)}function writeString(e,o,n){if(o.constructor.name=="Object")o=JSON.stringify(o);e.write(str2ab(o),n)}function appendBuffer(e,o){var n=new Uint8Array(e.byteLength+o.byteLength);n.set(e,0);n.set(o,e.byteLength);return n}var timeThing=(new Date).getTime();function timeTrace(e){var o=(new Date).getTime();console.log(e+": "+(o-timeThing));timeThing=o}function bufferToHex(e){var o=new Uint8Array(e);var n="";for(var t in o){t=o[t];if(t<16)n+="0"+t.toString(16);else n+=t.toString(16)}return n}function hexToBuffer(e){var o=new ArrayBuffer(e.length/2);var n=new Uint8Array(o);for(var t=0;t<e.length/2;t++){var r=e.substr(t*2,2);n[t]=parseInt(r,16)}return o}function base64ToArrayBuffer(e){var o=window.atob(e);var n=o.length;var t=new Uint8Array(n);for(var r=0;r<n;r++){var a=o.charCodeAt(r);t[r]=a}return t.buffer}function arrayBufferToBase64(e){var o="";var n=new Uint8Array(e);var t=n.byteLength;for(var r=0;r<t;r++){o+=String.fromCharCode(n[r])}return window.btoa(o)}var b64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var b64pad="=";function hex2b64(e){var o;var n;var t="";for(o=0;o+3<=e.length;o+=3){n=parseInt(e.substring(o,o+3),16);t+=b64map.charAt(n>>6)+b64map.charAt(n&63)}if(o+1==e.length){n=parseInt(e.substring(o,o+1),16);t+=b64map.charAt(n<<2)}else if(o+2==e.length){n=parseInt(e.substring(o,o+2),16);t+=b64map.charAt(n>>2)+b64map.charAt((n&3)<<4)}while((t.length&3)>0){t+=b64pad}return t}if(!String.prototype.startsWith){Object.defineProperty(String.prototype,"startsWith",{enumerable:false,configurable:false,writable:false,value:function(e,o){o=o||0;return this.lastIndexOf(e,o)===o}})}function getQueryVariable(e,o){if(!o)o=window.location;var n=o.search.substring(1);var t=n.split("&");for(var r=0;r<t.length;r++){var a=t[r].split("=");if(decodeURIComponent(a[0])==e){return decodeURIComponent(a[1])}}}Object.fromArray=function(e){var o={};for(var n in e){var t=e[n];o[t]=t}return o};$.ajaxTransport("+binary",function(e,o,n){if(window.FormData&&(e.dataType&&e.dataType=="binary"||e.data&&(window.ArrayBuffer&&e.data instanceof ArrayBuffer||window.Blob&&e.data instanceof Blob))){return{send:function(o,n){var t=new XMLHttpRequest,r=e.url,a=e.type,i=e.async||true,c=e.responseType||"blob",l=e.data||null,u=e.username||null,s=e.password||null;t.addEventListener("load",function(){var o={};o[e.dataType]=t.response;n(t.status,t.statusText,o,t.getAllResponseHeaders())});t.open(a,r,i,u,s);for(var f in o){t.setRequestHeader(f,o[f])}t.responseType=c;t.send(l)},abort:function(){n.abort()}}}});function throttleTimeout(e,o,n,t){if(!e)e={items:[]};e.items.push(o);if(!e.timeout){e.timeout=setTimeout(function(){delete e.timeout;t(e.items);e.items=[]},n)}return e}function copyTextToClipboard(e){var o=document.createElement("textarea");o.style.position="fixed";o.style.top=0;o.style.left=0;o.style.width="2em";o.style.height="2em";o.style.padding=0;o.style.border="none";o.style.outline="none";o.style.boxShadow="none";o.style.background="transparent";o.value=e;document.body.appendChild(o);o.select();try{var n=document.execCommand("copy")}catch(t){console.log("Oops, unable to copy")}document.body.removeChild(o)}function showNotification(e,o){console.log("notification:",e);if(!window.chrome||!window.chrome.notifications)return;var n=chrome.runtime.getManifest();var t=n.name;o=o||n.icons[128];chrome.notifications.create({type:"basic",iconUrl:o,title:t,message:e})}var blobFromUrl=function(){var e={};return function(o,n){if(e[o]){n(e[o]);return}var t=new XMLHttpRequest;t.open("GET",o,true);t.responseType="blob";t.onload=function(t){n(e[o]=window.URL.createObjectURL(this.response))};t.send()}}();function Success(){}(function(){function*e(){}var o=e();o.constructor.prototype.async=function(){var e=this;var o=e.next();if(o.done)return;function n(){o=e.throw(new Error(arguments));r()}function t(){var n=arguments[0];o=e.next(n);r()}function r(r){var a;var i;if(o.done)return;if(!o.value){o=e.next(t);return}if(o.value.constructor==Promise){o.value.then(t).catch(n);return}if(o.value==Error){a=true;o=e.next(n)}else if(o.value==Success){i=true;o=e.next(t)}else{throw new Error("Unexpected yield value for callback. Only Error and Success allowed.")}if(!o.value)throw new Error("Double yield callbacks must explicitly define both Error and Success");if(o.value==Error&&a)throw new Error("Error callback already defined");else if(o.value==Success&&i)throw new Error("Success callback already defined");else if(o.value!=Error&&o.value!=Success)throw new Error("Unexpected yield value for callback. Only Error and Success allowed.");if(a)o=e.next(t);else o=e.next(n)}r()}})();function spewSocket(e){e.read(function(o){console.log(ab2str(o));spewSocket(e)})}function getAuthToken(e,o){if(!window.chrome||!window.chrome.identity){console.error("no auth token implemented");process.nextTick(o);return}chrome.identity.getAuthToken({interactive:e,scopes:["https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/chromewebstore.readonly"]},function(e){if(!e)console.error("unable to get authToken",chrome.runtime.lastError);o(e)})}window.isElectron=function(){return navigator.userAgent.indexOf("Electron")!=-1};if(!isElectron()){window.sharedGlobals=window}(function(){var e=console.log;var o=console.error;var n="";function t(e){try{for(var o in e){if(e[o]&&e[o].constructor!=String)e[o]=JSON.stringify(e[o])}n+=e.join(" ")+"\n"}catch(t){}}console.error=function(){o.apply(console,arguments);t(Array.prototype.slice.call(arguments))};console.log=function(){e.apply(console,arguments);t(Array.prototype.slice.call(arguments))};sharedGlobals.getConsoleLog=function(e){e(n)};function r(e){return new Promise(function(o,n){if(!e.getConsoleLog){o("getConsoleLog not found");return}e.getConsoleLog(function(e){o({content:e})})})}window.gistConsoleLog=function(e,o){chrome.runtime.getBackgroundPage(function(n){r(n).then(function(o){e["background.txt"]=o;var n=chrome.app.window.getAll();var t=n.map(function(o){return r(o.contentWindow).then(function(n){e["window-"+o.id+".txt"]=n})});return Promise.all(t)}).then(function(){var n={description:chrome.runtime.getManifest().name+" console log","public":false,files:e};fetch("https://api.github.com/gists",{method:"POST",body:JSON.stringify(n)}).then(function(e){e.json().then(function(e){o(e.html_url)})})})})}})();function showModal(e){var o=$("#notificationModal");var n=o.find("#modal-ok");var t=o.find("#modal-cancel");n.unbind("click");t.unbind("click");o.unbind("hidden.bs.modal");e.cancelButton=e.cancelButton||"Cancel";e.okButton=e.okButton||"OK";e.title=e.title||chrome.runtime.getManifest().name;e.body=e.body||"";if(e.hideCancel)t.hide();else t.show();n.text(e.okButton);t.text(e.cancelButton);o.find("#modal-title").text(e.title);o.find("#modal-body").html(e.body);var r;n.click(function(){r=true;if(!e.ok||!e.ok())$("#notificationModal").modal("hide")});if(e.cancel){o.on("hidden.bs.modal",function(){if(!r)e.cancel()});t.click(e.cancel)}$("#notificationModal").modal();if(e.duration){setTimeout(function(){$("#notificationModal").modal("hide")},e.duration)}}function shortModal(e,o){showModal({title:e,body:o,duration:8e3,hideCancel:true})}(function(){$(document).ready(function(){$("#purchase-options").hide();getAuthToken(true,function(e){if(!e){function o(){chrome.app.window.current().close()}showModal({hideCancel:true,body:"Unable to get your Google Login. Are you logged into Chrome? If so, please open an issue on the Support Forum.",ok:o,cancel:o});return}chrome.identity.getProfileUserInfo(function(e){if(e)$("#purchase-email").text(e.email)})});chrome.storage.local.get(["vysorUsage"],function(e){var o=e.vysorUsage;if(!o)o=0;var n=o/(60*60*1e3);n=Math.round(n*2)/2;$("#used").html("<span class='time-highlight'>You've used Vysor Free for "+n+" hours. Support Vysor. Go Pro.</span>")});function e(){$("#paymentModal").modal("hide");getAuthToken(true,function(e){if(!e){shortModal(null,"Unable to retrieve Google auth token. Are you behind a firewall or using a VPN?");return}var o="https://billing.clockworkmod.com/api/v1/paypalorder/koushd@gmail.com/vysor.lifetime?return_url=https://vysor.clockworkmod.com/purchase&sandbox=false&token="+e;chrome.browser.openTab({url:o});chrome.app.window.current().close()}.bind(this))}function o(){$("#paymentModal").modal("hide");getAuthToken(true,function(e){if(!e){shortModal(null,"Unable to retrieve Google auth token. Are you behind a firewall or using a VPN?");return}var o="https://billing.clockworkmod.com/api/v1/stripeorder/koushd@gmail.com/vysor.lifetime?return_url=https://vysor.clockworkmod.com/purchase&sandbox=false&token="+e;chrome.browser.openTab({url:o});chrome.app.window.current().close()}.bind(this))}function n(e){$("#paymentModal").modal("hide");getAuthToken(true,function(o){if(!o){shortModal(null,"Unable to retrieve Google auth token. Are you behind a firewall or using a VPN?");return}var n="https://billing.clockworkmod.com/subscription/stripe/manage/koushd@gmail.com/"+e+"/";chrome.browser.openTab({url:n});chrome.app.window.current().close()}.bind(this))}function t(e){$("#paymentModal").modal("hide");if(isElectron()){showModal({ok:function(){chrome.browser.openTab({url:"https://chrome.google.com/webstore/detail/vysor/gidgenkbbabolejbgbpnhbimgjbffefm"})},hideCancel:true,body:'Google Wallet licenses can be purchased from within the <a href="https://chrome.google.com/webstore/detail/vysor/gidgenkbbabolejbgbpnhbimgjbffefm?authuser=1" target="_blank">Vysor for Chrome</a> app.<br/><br/>The license will also unlock the desktop version of Vysor.'});return}google.payments.inapp.getPurchases({parameters:{env:"prod"},success:function(){google.payments.inapp.buy({parameters:{env:"prod"},sku:e,success:function(){refreshLicenseManager();console.log("success",arguments)},failure:function(){refreshLicenseManager();console.log("failure",arguments)}})},failure:function(){showModal({hideCancel:true,body:"Unable to purchase from Chrome store. This error may occur if you already have a Vysor subscription that is past due. Please contact support."})}})}function r(e){$("#paymentModal").modal("hide");showModal({ok:function(){i(e)},hideCancel:true,body:"Paypal subscriptions are not available for this plan."})}var a={monthly:{google:function(){t("vysor_monthly")},stripe:function(){n("vysor.monthly")},paypal:r},annual:{google:function(){t("vysor.annual2")},stripe:function(){n("vysor.annual")},paypal:r},lifetime:{google:function(){t("vysor.lifetime")},stripe:o,paypal:e}};function i(e){$("#pay-card").unbind("click");$("#pay-google").unbind("click");$("#pay-alipay").unbind("click");$("#pay-paypal").unbind("click");$("#pay-card").click(a[e].stripe);$("#pay-alipay").click(a[e].stripe);$("#pay-google").click(a[e].google);$("#pay-paypal").click(function(){a[e].paypal(e)});$("#paymentModal").modal()}$(".plan-enterprise").click(function(){var e="https://billing.vysor.io/";chrome.browser.openTab({url:e});chrome.app.window.current().close()});$(".plan-monthly").click(function(){i("monthly")});$(".plan-annual").click(function(){i("annual")});$(".plan-lifetime").click(function(){i("lifetime")});$("#retrieve").click(function(){getAuthToken(true,function(e){if(!e){console.log("Unable to get token for retrieve?");return}refreshLicenseManager(function(e){if(!e){chrome.identity.getProfileUserInfo(function(e){if(!e){showModal({hideCancel:true,body:"Unable to get your Google Login. Are you logged into Chrome? If so, please open an issue on the Support Forum."});return}showModal({hideCancel:true,body:"No license found for account "+e.email+'. If this message was in error, please open an issue on the Support Forum.<br/><br/>Wrong account? <a href="https://plus.google.com/110558071969009568835/posts/5dWULG7ALmB" target="_blank">Read this</a>.'})})}})})})})})();
